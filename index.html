<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Live Weather & Time</title>
<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#1e3c72;
  color:white;
  text-align:center;
}
.box{
  margin-top:100px;
  background:rgba(0,0,0,0.5);
  padding:25px;
  border-radius:15px;
  display:inline-block;
}
#out{margin-top:20px; font-size:18px;}
</style>
</head>

<body>
<h1>üå¶Ô∏è Live Weather, Wind Chill & Time</h1>

<div class="box">
  <button onclick="startLive()">Start Live Weather</button>
  <div id="out"></div>
</div>

<script>
function calculateWindChill(tempC, windKmh){
  if(tempC > 10 || windKmh < 4.8) return tempC.toFixed(1);
  const v = windKmh;
  const t = tempC;
  return (13.12 + 0.6215*t - 11.37*Math.pow(v,0.16) + 0.3965*t*Math.pow(v,0.16)).toFixed(1);
}

let intervalId;

async function updateLive(lat, lon, timezone){
  try{
    const weatherRes = await fetch(
      `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`
    );
    const weather = await weatherRes.json();
    const temp = weather.current_weather.temperature;
    const wind = weather.current_weather.windspeed;
    const chill = calculateWindChill(temp, wind);

    const now = new Date().toLocaleString("en-AU", {
      timeZone: timezone,
      hour12: true,
      hour:"2-digit",
      minute:"2-digit",
      second:"2-digit"
    });

    document.getElementById("out").innerHTML =
      `Temp: ${temp} ¬∞C<br>` +
      `Wind: ${wind} km/h<br>` +
      `Wind Chill: ${chill} ¬∞C<br>` +
      `Local Time: ${now}`;
  } catch {
    document.getElementById("out").textContent="Error fetching live data";
  }
}

function startLive(){
  if(!navigator.geolocation){
    document.getElementById("out").textContent="Location not supported";
    return;
  }
  navigator.geolocation.getCurrentPosition(async (position) => {
    const lat = position.coords.latitude;
    const lon = position.coords.longitude;

    // get timezone name
    const tzRes = await fetch(
      "https://api.open-meteo.com/v1/forecast?latitude=" +
      lat + "&longitude=" + lon + "&hourly=temperature_2m"
    );
    const tzData = await tzRes.json();
    const timezone = tzData.timezone;

    if(intervalId) clearInterval(intervalId);
    updateLive(lat, lon, timezone);
    intervalId = setInterval(() => updateLive(lat, lon, timezone), 1000);

  }, () => {
    document.getElementById("out").textContent="Permission denied";
  });
}
</script>

</body>
</html>
